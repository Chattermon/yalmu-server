<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yalmu. Connecting the World</title>
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Reddit+Sans:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
    <style>
        /* Global Styles */
        * {
            box-sizing: border-box;
        }
        body {
  font-family: "Reddit Sans", sans-serif;

            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        /* Navbar Styles */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 22px;
            background-color: #fff;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }

        .navbar-left,
        .navbar-center,
        .navbar-right {
            display: flex;
            align-items: center;
        }

        .navbar-center {
            flex-grow: 1;
            justify-content: center;
        }

        .navbar .logo img {
            width: 160px;
            margin-bottom:-4px;
        }

        .search-container {
            position: relative;
            width: 600px;
        }

        .search-container input[type="text"] {
            width: 100%;
            padding: 12.5px 15px 12.5px 40px;
            border-radius: 50rem;
            border: none;
            background-color: #e5ebee;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        .search-container input[type="text"]:focus {
            background-color: #e0e0e0;
            outline: none;
        }
        .search-container .search-icon {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            font-size: 1em;
            color: #888;
        }

        .navbar-right .user-icon,
        .navbar-right .hamburger-menu {
            font-size: 1.5em;
            color: #333;
            margin-left: 20px;
            cursor: pointer;
        }

        /* Hide mobile hamburger icon by default */
        .navbar-left .hamburger-icon {
            display: none;
        }

        /* Main Container */
        .main-container {
            display: flex;
            align-items: flex-start;
        }

        /* Vertical Navbar */
        .vertical-navbar {
            width: 265px;
            background-color: #fff;
            padding: 0px 0px 20px 0px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
            position: sticky;
            top: 60px;
            height: calc(100vh - 60px);
        }

        .vertical-navbar h2 {
            margin-left: 1rem;
            font-size: 0.975em;
            color: #706f6f;
            margin-bottom: 10px;
            margin-top:20px;
            font-weight:400;
            padding: 0px 0px 0px 10px;
            
        }
 .vertical-navbar hr {
            color: #333;
        }

        .vertical-navbar a {
              text-decoration: none;
            color: #333;
            padding: 10px 10px;
            font-size: 1em;
            display: flex;
            align-items: center;
                transition: background-color 0.5s, font-weight 0.1s, padding 0.5s;

                        margin: 0px 17px 0px 1rem;
            background-color: #fff;
            border-radius:5px;
            
        }
        
      
        
        .vertical-navbar .display {
           text-decoration: none;
            color: #333;
            padding: 15px 20px;
            font-size: 1em;
            display: flex;
            align-items: center;
                transition: background-color 0.5s;

            background-color: #e1eef7;
          
          }
          
           .vertical-navbar .display h2{
          margin:0px 0px 0px 0px;
            font-size: 1em;
            color: #333;
          
          }
           .vertical-navbar .display img{
          width: 24px;
            height: 24px;
            margin-right: 10px;
          
          }
          
      .vertical-navbar a img{
          width: 30px;
            height: 30px;
            margin-right: 10px;
            border-radius:45px;
          
          }
          
     
.vertical-navbar a:hover {
    background-color: #f2f2f2;
    font-weight: bold;
}

@keyframes borderGradient {
    0% {
        border-color: #2b79ff;
    }
    25% {
        border-color: #007BFF;
    }
    50% {
        border-color: #2b79ff;
    }
    75% {
        border-color: #007BFF;
    }
    100% {
        border-color: #2b79ff;
    }
}


.vertical-navbar .special a {
       text-decoration: none;
            color: #333;
            padding: 10px 10px;
            font-size: 1em;
            display: flex;
            align-items: center;
                transition: background-color 0.5s, font-weight 0.1s, padding 0.5s;

                        margin: 0px 17px 0px 17px;
            background-color: #fff;
            border-radius:5px;
}

.vertical-navbar .special a:hover {
    background-color: #fff;
    padding: 20px 30px;
    font-weight: bold;
    color: #000;
    border: 6px solid transparent; /* Add transparent border on hover */
    animation: borderGradient 2s infinite alternate;
    
}
 .vertical-navbar .special a img{
          width: 25px;
            height: 25px;
            margin-right: 10px;
            border-radius:45px;
          
          }



    
           #spec {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            margin-left:10px;
            align-items:center;
            justify-content:center;
            border-radius:0px;
        }

        /* Main Content Styles */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        /* Post Section Styles */
        .post-section {
            background-color: #fff;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 15px;
        }
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: #555;
        }
        .post-header img {
            width: 20px;
            margin-right: 10px;
        }
        .post-title {
            font-size: 1.2em;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .post-content {
            margin-bottom: 10px;
            font-size: 1em;
            color: #333;
        }
        .post-author {
            display: flex;
            align-items: center;
            color: #888;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .post-author img {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .post-time-ago {
            color: #aaa;
            font-size: 0.8em;
        }

        /* Right Sidebar (Chat Space) */
        .right-sidebar {
            width: 300px;
            padding: 20px;
            background-color: #fff;
            position: sticky;
            top: 60px;
            height: calc(100vh - 60px);
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .right-sidebar h2 {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        .chat-message {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        .chat-message img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .message-content {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 10px;
            width: 100%;
            word-wrap: break-word;
            word-break: break-word;
            max-width: 80%;
        }
        .message-user {
            font-weight: bold;
            font-size: 0.9em;
            color: #333;
            margin-bottom: 5px;
        }
        .message-text {
            font-size: 0.9em;
            color: #555;
        }

        /* Own Message Styles */
        .chat-message.own-message {
            flex-direction: row-reverse;
            text-align: right;
        }
        .chat-message.own-message img {
            margin-left: 10px;
            margin-right: 0;
        }
        .chat-message.own-message .message-content {
            background-color: #007BFF;
            color: #fff;
        }
        .chat-message.own-message .message-user {
            color: #fff;
        }
        .chat-message.own-message .message-text {
            color: #fff;
        }

        /* System Message Styles */
        .system-message {
            text-align: center;
            color: #888;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        /* Chat Input Styles */
        .chat-input {
            display: flex;
            align-items: center;
            border-top: 1px solid #e0e0e0;
            padding-top: 10px;
        }
        .chat-input input[type="text"] {
            flex-grow: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 20px;
            font-size: 0.9em;
            outline: none;
            transition: border-color 0.3s;
        }
        .chat-input input[type="text"]:focus {
            border-color: #888;
        }
        .chat-input button {
            margin-left: 10px;
            padding: 8px 12px;
            border: none;
            background-color: #007BFF;
            color: #fff;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }
        .chat-input button:hover {
            background-color: #0056b3;
        }

        /* New Styles for Post System */
        .post-form {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
                        box-shadow: 0 1px 6px 1.5px rgba(0, 0, 0, 0.1)

        }


        .post-form .header {
          display:flex;
          align-items:center;
          
          }
          
          .post-form .header h2 {
             margin-bottom: 15px;
            font-size: 1.25em;
            color: #333;      
            font-weight:normal;
          } 
          
          
          
          
        .post-form h2 {
            margin-bottom: 15px;
            font-size: 1.5em;
            color: #333;
            
        }

        .post-form input[type="text"],
        .post-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        .post-form button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .post-form button:hover {
            background-color: #0056b3;
        }

#warn {
            padding: 10px 8px;
            background-color: #fff;
            color: #8f8f8f;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size:12px;
        }
        
        #club {
              margin-bottom: 15px;
            font-size: 1.25em;
            color: #3d3d3d;       
            padding: 8px 18px 8px 18px;
            background-color: #e5ebee;
            font-weight:300;
            margin-left:10px;
            border-radius: 45px;
            align-items:center;
            display:flex;
            
            
        }
        
           #clubimg {
            height:1.5rem;
            width:auto;
            border-radius:45px;
            margin-right:0.5rem;
            
        }
        
        #warn:hover {
            padding: 10px 8px;
            background-color: #fff;
            color: #007BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size:12px;
        }

      
        
        /* Posts Container Styles */
        #postsContainer {
            display: flex;
            flex-direction: column;
        }

        /* Chat Button */
        .chat-button {
            display: none; /* Hidden on desktop */
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #007BFF;
            color: #fff;
            border-radius: 50%;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 1000;
        }

        /* Mobile Styles */
        @media (max-width: 992px) {
            /* Hide the right-sidebar */
            .right-sidebar {
                display: none;
            }

            /* Make posts full width */
            .main-content {
                max-width: 100%;
                padding: 10px;
            }

            /* Increase font sizes on mobile */
            .post-form h2,
            .post-title {
                font-size: 2em; /* Increased font size */
            }
            .post-content,
            .post-form input[type="text"],
            .post-form textarea {
                font-size: 1.5em; /* Increased font size */
            }

            /* Increase padding and margins for posts */
            .post-section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .post-author,
            .post-time-ago {
                font-size: 1em; /* Increased font size */
            }

            .post-author img {
                width: 30px;
                height: 30px;
                margin-right: 10px;
            }

            .navbar {
                padding: 10px 20px;
            }
            .navbar .logo img {
                width: 100px;
            }
            .search-container {
                width: 100%;
            }
            .search-container input[type="text"] {
                font-size: 1em;
            }

            /* Show chat button */
            .chat-button {
                display: flex;
            }

            /* Navbar adjustments */
            .navbar-left .hamburger-icon {
                display: block;
                font-size: 1.5em;
                color: #333;
                margin-right: 20px;
                cursor: pointer;
            }
            .navbar-left .logo {
                margin-left: 0;
            }

            /* Hide vertical navbar by defagult */
            .vertical-navbar-container {
                display: none;
                position: fixed;
                top: 60px;
                left: 0;
                width: 220px;
                height: calc(100vh - 60px);
                background-color: #fff;
                overflow-y: auto;
                border-right: 1px solid #e0e0e0;
                z-index: 1000;
            }

            /* Adjust vertical navbar for desktop */
            .vertical-navbar-desktop {
                display: none;
            }

            /* Style for chat popup */
           .chat-popup {
    /* Existing styles */
    display: none;
    position: fixed;
    top: 10%;
    right: 5%;
    width: 70%;
    height: 80%;
    background-color: #fff;
    border-radius: 10px;
    /* Updated box-shadow to add shadow to every side */
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    flex-direction: column;
    z-index: 1000;
}


            .chat-popup h2 {
                text-align: center;
                padding: 10px;
                border-bottom: 1px solid #e0e0e0;
                font-size: 1.5em; /* Increase font size */
            }

            .chat-popup .chat-messages {
                flex-grow: 1;
                padding: 10px;
                overflow-y: auto;
            }

            .chat-popup .chat-input {
                padding: 10px;
                border-top: 1px solid #e0e0e0;
            }
            .chat-input input[type="text"] {
                font-size: 1em; /* Increase font size */
            }
        }

        /* Hide mobile vertical navbar on desktop */
        @media (min-width: 993px) {
            .vertical-navbar-container {
                display: none;
            }

            /* Show desktop vertical navbar */
            .vertical-navbar-desktop {
                display: flex;
            }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <div class="navbar">
        <div class="navbar-left">
            <!-- Hamburger Icon for Mobile -->
            <i class="fas fa-bars hamburger-icon" id="hamburgerIcon"></i>
            <div class="logo">
                <a href="index.html"><img src="sudal.svg" alt="Yalmu Logo"></a>
            </div>
        </div>
        <div class="navbar-center">
            <div class="search-container">
                <input type="text" placeholder="Search">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>
        <div class="navbar-right">
            <i class="fas fa-user-circle user-icon"></i>
            <!-- Hamburger menu next to user icon -->
            <i class="fas fa-bars hamburger-menu"></i>
        </div>
    </div>

    <!-- Vertical Navbar Container (Mobile) -->
    <div id="verticalNavbarContainer" class="vertical-navbar-container">
        <!-- Vertical Navbar -->
        <div class="vertical-navbar">
            <h2>Your Clubs</h2>
            <a href="club1.html">
                <img src="club1-icon.png" alt="Club 1">
                Club One
            </a>
            <a href="club2.html">
                <img src="club2-icon.png" alt="Club 2">
                Club Two
            </a>
            <a href="club3.html">
                <img src="club3-icon.png" alt="Club 3">
                Club Three
            </a>
            
             <a href="club3.html" class="add-club">
                         <i class="fas fa-bars hamburger-menu"></i>

                <img src="club3-icon.png" alt="Club 3">
                Club Three
            </a>
            <!-- Add more clubs as needed -->
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Vertical Navbar (Desktop) -->
        <div class="vertical-navbar vertical-navbar-desktop">
       <br>
            <a href="club1.html">
                            <img id="spec" src="home.png" alt="Club 2">

                Home
            </a>
            <a href="club2.html">
                <img id="spec" src="bar-chart.png" alt="Club 2">
                Popular
            </a>
            <a href="club3.html">
                <img id="spec" src="puzzle.png" alt="Club 3">
                All
            </a>
          

          <div style="height: 1px; background-color: #ccc; margin: 15px 20px 0px 20px;"></div>

          
            <h2>FAVORITES</h2>
            <a href="club1.html">
                <img src="Unknown.jpeg" alt="Club 1">
                TestGroup
            </a>
            <a href="club2.html">
                            <img src="Unknown.jpeg" alt="Club 1">

                JacobGroup
            </a>
            <a href="club3.html">
                            <img src="Unknown.jpeg" alt="Club 1">

                THirdClub
            </a>
         
          
          
          <div style="height: 1px; background-color: #ccc; margin: 15px 20px 0px 20px;"></div>

          
        
        
            <h2>CLUBS</h2>
            
          
            
             <div class="special">
            <a href="club3.html" type="special">
                            <img src="plus.png" alt="Club 1">

                Add Clubs
            </a>
            </div>
            
             <div class="special">
            <a href="club3.html" type="special">
                            <img src="plus.png" alt="Club 1">

                Make a Club
            </a>
            </div>
            
            
            <a href="club1.html">
                            <img src="Unknown.jpeg" alt="Club 1">

                TestGroup
            </a>
            <a href="club2.html">
                            <img src="Unknown.jpeg" alt="Club 1">

                JacobGroup
            </a>
            <a href="club3.html">
                            <img src="Unknown.jpeg" alt="Club 1">

                THirdClub
            </a>
           
            
            <!-- Add more clubs as needed -->
        </div>

        <!-- Main Content -->
        <div class="main-content">

            <!-- Post Submission Form -->
            <div class="post-form">
            <div class="header"> <h2>Create a New Post in</h2>
                                <h2 id="club"><img id="clubimg" src="Unknown.jpeg" alt="Club 1">a/home</h2></div>
               

                <input type="text" id="postTitle" placeholder="Your grand title...">
                <textarea id="postContent" style="            font-family: Arial, sans-serif; 
" placeholder="Write whats on your mind..."></textarea>
                <button id="submitPost">Post it!</button>
                <button id="warn">Please abide the rules of our community. Click here to learn more.</button>


            </div>

            <!-- Container to Display Posts -->
            <div id="postsContainer">
                <!-- Existing posts will be displayed here -->
            </div>

        </div>

        <!-- Right Sidebar (Chat Space for Desktop) -->
        <div class="right-sidebar">
            <h2>Global Chat</h2>
            <div class="chat-messages" id="chatMessages">
                <!-- Chat messages will be dynamically inserted here -->
            </div>
            <!-- Chat Input -->
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Type a message...">
                <button id="sendButton"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Chat Button (Mobile) -->
    <div id="chatButton" class="chat-button">
        <i class="fas fa-comments"></i>
    </div>

    <!-- Chat Popup (Mobile) -->
    <div id="chatPopup" class="chat-popup">
        <h2>Global Chat</h2>
        <div class="chat-messages" id="chatMessagesPopup">
            <!-- Chat messages will be dynamically inserted here -->
        </div>
        <!-- Chat Input -->
        <div class="chat-input">
            <input type="text" id="chatInputPopup" placeholder="Type a message...">
            <button id="sendButtonPopup"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- Define Username Globally -->
    <script>
        // Generate a random username and avatar for demonstration
        window.username = 'User' + Math.floor(Math.random() * 1000);
        window.userAvatar = 'https://i.pravatar.cc/40?u=' + window.username;
    </script>

    <!-- Include ScaleDrone SDK -->
    <script src="https://cdn.scaledrone.com/scaledrone.min.js"></script>

    <!-- JavaScript for Real-Time Chat Functionality -->
    <script>
        // Replace with your ScaleDrone Channel ID
        const CHANNEL_ID = 'ophkI2NC4wngYgtB'; // <-- Ensure this is your actual Channel ID

        // Access the global username and avatar
        const username = window.username;
        const userAvatar = window.userAvatar;

        // Initialize ScaleDrone with clientData set once
        const drone = new ScaleDrone(CHANNEL_ID, {
            data: {
                name: username,
                avatar: userAvatar
            }
        });

        // Room name
        const ROOM_NAME = 'observable-room';

        let currentUserId = null; // To store the current user's ID

        // On successful connection
        drone.on('open', error => {
            if (error) {
                return console.error(error);
            }

            currentUserId = drone.clientId; // Store the client ID

            // Subscribe to the room
            const room = drone.subscribe(ROOM_NAME);

            room.on('open', error => {
                if (error) {
                    return console.error(error);
                }
            });

            // Listen for messages in the room
            room.on('data', (data, member) => {
                // If it's a system message
                if (data.system) {
                    displaySystemMessage(member, data.text);
                } else {
                    addMessage(member, data);
                }
            });

            // Inform others that a new user has joined
            drone.publish({
                room: ROOM_NAME,
                message: {
                    text: `${username} has joined the chat`,
                    system: true
                }
            });
        });

        // Handle connection errors
        drone.on('error', error => {
            console.error(error);
        });

        // Function to add a message to the chat
        function addMessage(member, message) {
            // Determine which chat to add the message to
            const chatMessagesDesktop = document.getElementById('chatMessages');
            const chatMessagesPopup = document.getElementById('chatMessagesPopup');

            const chatMessageDesktop = createChatMessageElement(member, message, currentUserId);
            const chatMessagePopup = createChatMessageElement(member, message, currentUserId);

            // Append to both desktop and popup chats
            if (chatMessagesDesktop) {
                chatMessagesDesktop.appendChild(chatMessageDesktop);
                chatMessagesDesktop.scrollTop = chatMessagesDesktop.scrollHeight;
            }

            if (chatMessagesPopup) {
                chatMessagesPopup.appendChild(chatMessagePopup);
                chatMessagesPopup.scrollTop = chatMessagesPopup.scrollHeight;
            }
        }

        function createChatMessageElement(member, message, currentUserId) {
            const chatMessage = document.createElement('div');
            chatMessage.classList.add('chat-message');

            // Check if the message is from the current user
            const isOwnMessage = member.id === currentUserId;

            if (isOwnMessage) {
                chatMessage.classList.add('own-message');
            }

            const userIcon = document.createElement('img');
            userIcon.src = isOwnMessage ? userAvatar : member.clientData.avatar;
            userIcon.alt = isOwnMessage ? 'You' : member.clientData.name;

            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');

            const messageUser = document.createElement('div');
            messageUser.classList.add('message-user');
            messageUser.textContent = isOwnMessage ? 'You' : member.clientData.name;

            const messageTextDiv = document.createElement('div');
            messageTextDiv.classList.add('message-text');
            messageTextDiv.textContent = message.text;

            // Assemble message
            messageContent.appendChild(messageUser);
            messageContent.appendChild(messageTextDiv);
            chatMessage.appendChild(userIcon);
            chatMessage.appendChild(messageContent);

            return chatMessage;
        }

        // Function to display system messages
        function displaySystemMessage(member, text) {
            const chatMessagesDesktop = document.getElementById('chatMessages');
            const chatMessagesPopup = document.getElementById('chatMessagesPopup');

            const systemMessage = document.createElement('div');
            systemMessage.classList.add('system-message');
            systemMessage.textContent = text;

            if (chatMessagesDesktop) {
                chatMessagesDesktop.appendChild(systemMessage);
                chatMessagesDesktop.scrollTop = chatMessagesDesktop.scrollHeight;
            }

            if (chatMessagesPopup) {
                chatMessagesPopup.appendChild(systemMessage.cloneNode(true));
                chatMessagesPopup.scrollTop = chatMessagesPopup.scrollHeight;
            }
        }

        // Send message function
        function sendMessage(inputElement) {
            const messageText = inputElement.value.trim();
            if (messageText === '') return;

            // Publish the message to the room without clientData
            drone.publish({
                room: ROOM_NAME,
                message: {
                    text: messageText,
                    system: false
                }
            });

            // Clear input
            inputElement.value = '';
        }

        // Event listeners for send buttons
        document.getElementById('sendButton').addEventListener('click', function() {
            sendMessage(document.getElementById('chatInput'));
        });

        document.getElementById('sendButtonPopup').addEventListener('click', function() {
            sendMessage(document.getElementById('chatInputPopup'));
        });

        // Event listeners for Enter key
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage(document.getElementById('chatInput'));
            }
        });

        document.getElementById('chatInputPopup').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage(document.getElementById('chatInputPopup'));
            }
        });

        // Chat Button and Popup
        const chatButton = document.getElementById('chatButton');
        const chatPopup = document.getElementById('chatPopup');

        chatButton.addEventListener('click', function(event) {
            event.stopPropagation();
            chatPopup.style.display = chatPopup.style.display === 'flex' ? 'none' : 'flex';
        });

        // Close chat popup when clicking outside
        document.addEventListener('click', function(event) {
            if (!chatPopup.contains(event.target) && !chatButton.contains(event.target)) {
                chatPopup.style.display = 'none';
            }
        });

        // Prevent clicks inside chat popup from closing it
        chatPopup.addEventListener('click', function(event) {
            event.stopPropagation();
        });

        // Hamburger Icon and Vertical Navbar
        const hamburgerIcon = document.getElementById('hamburgerIcon');
        const verticalNavbarContainer = document.getElementById('verticalNavbarContainer');

        hamburgerIcon.addEventListener('click', function(event) {
            event.stopPropagation();
            verticalNavbarContainer.style.display = verticalNavbarContainer.style.display === 'block' ? 'none' : 'block';
        });

        // Close vertical navbar when clicking outside
        document.addEventListener('click', function(event) {
            if (!verticalNavbarContainer.contains(event.target) && !hamburgerIcon.contains(event.target)) {
                verticalNavbarContainer.style.display = 'none';
            }
        });

        // Prevent clicks inside vertical navbar from closing it
        verticalNavbarContainer.addEventListener('click', function(event) {
            event.stopPropagation();
        });
    </script>

    <!-- JavaScript for Post System -->
    <script>
        // Configuration
        //const JSONBIN_API_KEY = '$2a$10$.bjhWFqw/pof4TG6L72kkuDlXaJNtJoeXJbfM0pSdLGASJzFtQZq6'; // Replace with your actual API key
       // const JSONBIN_BIN_ID = '6708d164e41b4d34e440c75e';   // Replace with your actual Bin ID
        //const JSONBIN_API_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`;
       // const JSONBIN_PUT_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;
        const OPENAI_API_KEY = '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'

        // Function to fetch existing posts
        async function fetchPosts() {
            try {
                const response = await fetch(JSONBIN_API_URL, {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                const data = await response.json();
                const posts = data.record.posts; // Access the 'posts' array

                // Clear the container
                const postsContainer = document.getElementById('postsContainer');
                postsContainer.innerHTML = '';

                // Display each post
                posts.forEach(post => {
                    displayPost(post);
                });
            } catch (error) {
                console.error('Error fetching posts:', error);
                alert('Failed to load posts. Please try again later.');
            }
        }




async function isContentClean(content) {
  

    // Then, use OpenAI moderation
    const response = await fetch('https://api.openai.com/v1/moderations', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
            model: 'omni-moderation-latest',
            input: content
        })
    });

    const result = await response.json();
    console.log('Moderation result:', result); // Log the result for debugging

    if (!result || !result.results || !Array.isArray(result.results) || !result.results[0]) {
        throw new Error('Unexpected response structure from OpenAI API');
    }
    return !result.results[0].flagged; // Return true if not flagged, false otherwise
}





async function submitPost() {
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('postContent').value.trim();
    const author = window.username; // Ensure 'username' is defined
    const authimg = window.userAvatar;

    if (!title || !content) {
        alert('Please fill in both the title and content.');
        return;
    }

    const newPost = {
        title: title,
        content: content,
        author: author,
        timestamp: Date.now()
    };

    try {
        // Check if the content is clean
        const cleanContent = await isContentClean(newPost.content);

        if (!cleanContent) {
            alert('Your post contains inappropriate language. Please modify your content.');
            return;
        }

        // Fetch current posts
        const response = await fetch(JSONBIN_API_URL, {
            headers: {
                'X-Master-Key': JSONBIN_API_KEY
            }
        });
        const data = await response.json();
        const posts = data.record.posts;

        // Add the new post to the beginning of the array
        posts.unshift(newPost);

        // Update the bin with the new posts array
        await fetch(JSONBIN_PUT_URL, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': JSONBIN_API_KEY,
                'X-Bin-Private': 'false' // Ensure it's public
            },
            body: JSON.stringify({ posts: posts })
        });

        // Display the new post at the top
        displayPost(newPost, true);

        // Clear the form
        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';
    } catch (error) {
        console.error('Error submitting post:', error);
        alert('Failed to submit post. Please try again later.');
    }
}


        // Function to display a single post
        function displayPost(post, isNewPost = false) {
            const postsContainer = document.getElementById('postsContainer');

            // Create post elements
            const postSection = document.createElement('div');
            postSection.classList.add('post-section');

            const postHeader = document.createElement('div');
            postHeader.classList.add('post-header');
            postHeader.innerHTML = `
                <img src="alluoo-icon.png" alt="Alluoo">
                Posted on Alluoo
            `;

            const postTitle = document.createElement('div');
            postTitle.classList.add('post-title');
            postTitle.textContent = post.title;

            const postContent = document.createElement('div');
            postContent.classList.add('post-content');
            postContent.textContent = post.content;
            

            const postAuthor = document.createElement('div');
            postAuthor.classList.add('post-author');
            postAuthor.innerHTML = `
                <img src="postimg.png" alt="${post.author}'s icon">
                <div>${post.author}</div>
            `;

            const postTimeAgo = document.createElement('div');
            postTimeAgo.classList.add('post-time-ago');
            postTimeAgo.textContent = timeSince(post.timestamp) + ' ago';

            // Append elements to the post section
            postSection.appendChild(postHeader);
            postSection.appendChild(postTitle);
            postSection.appendChild(postContent);
            postSection.appendChild(postAuthor);
            postSection.appendChild(postTimeAgo);

            if (isNewPost) {
                // Insert the new post at the top
                postsContainer.insertBefore(postSection, postsContainer.firstChild);
            } else {
                // Append the post to the container
                postsContainer.appendChild(postSection);
            }
        }

        // Function to calculate time since the post was made
        function timeSince(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            let interval = Math.floor(seconds / 31536000);

            if (interval >= 1) {
                return interval + ' year' + (interval > 1 ? 's' : '');
            }
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) {
                return interval + ' month' + (interval > 1 ? 's' : '');
            }
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) {
                return interval + ' day' + (interval > 1 ? 's' : '');
            }
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) {
                return interval + ' hour' + (interval > 1 ? 's' : '');
            }
            interval = Math.floor(seconds / 60);
            if (interval >= 1) {
                return interval + ' minute' + (interval > 1 ? 's' : '');
            }
            return Math.floor(seconds) + ' second' + (seconds > 1 ? 's' : '');
        }

        // Event listener for the submit button
        document.getElementById('submitPost').addEventListener('click', submitPost);

        // Initial fetch of posts when the page loads
        window.onload = fetchPosts;
    </script>

</body>
</html>